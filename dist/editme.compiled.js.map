{"version":3,"sources":["../src/editme.js"],"names":[],"mappings":"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","file":"editme.compiled.js","sourcesContent":["(function (root, factory) {\n  // AMD\n  if (typeof define === 'function' && define.amd) {\n    define(['angular'], function (angular) {\n      return factory(angular);\n    });\n  }\n  // Node.js\n  else if (typeof exports === 'object') {\n    module.exports = factory(require('angular'));\n  }\n  // Angular\n  else if (angular) {\n    factory(root.angular);\n  }\n}(window, function (angular) {\n  'use strict';\n\n  let m = angular.module('shaka-editme', []);\n\n  /**\n   * Component wrapper for SVG edit icon\n   */\n  m.component('skEditmeIcon', {\n    template: `\n      edit-icon\n      <svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">\n        <path d=\"M30.173 7.542l-0.314 0.314-5.726-5.729 0.313-0.313c0 0 1.371-1.813 3.321-1.813 0.859 0 1.832 0.353 2.849 1.37 3.354 3.354-0.443 6.171-0.443 6.171zM27.979 9.737l-19.499 19.506-8.48 2.757 2.756-8.485v-0.003h0.002l19.496-19.505 0.252 0.253zM2.76 29.239l4.237-1.219-2.894-3.082-1.343 4.301z\"></path>\n      </svg>\n    `\n  })\n\n\n  m.directive('skEditme', ($compile, $timeout) => {\n    let directive = {\n      require: '^form',\n      scope : {\n        model: '=',\n        isEditing: '=?',\n        hideIcon: '=?',\n        onEditChange: '&?',\n        onInvalid: '&?'\n      },\n      controller: function($scope) {\n        $scope.toggleEdit = (value) => {\n          $scope.isEditing = (value !== undefined) ? value : !$scope.isEditing;\n        };\n      },\n      link: link,\n      transclude: true,\n      template: `\n        <div ng-click=\"toggleEdit(true)\">\n          <span ng-hide=\"isEditing\" class=\"model-wrapper\" ng-class=\"{'hide-icon': hideIcon}\">\n            <span class=\"model-content\" ng-class=\"{'edit-active': showEditHint}\">{{model}}</span>\n            <sk-editme-icon ng-class=\"{'edit-active': showEditHint}\" ng-if=\"!isEditing && !hideIcon\"></sk-editme-icon>\n          </span>\n          <content ng-show=\"isEditing\"></content>\n        </div>\n      `\n    };\n\n    return directive;\n\n    function link(scope, element, attrs, formCtrl, transclude) {\n      let $content  = element.find('content');\n      let $input    = undefined;\n      let $static   = angular.element(element[0].querySelector('.model-content'));\n      const KEYS    = {\n        ENTER: 13\n      };\n\n      scope.showIcon = scope.showIcon || true;\n\n      transclude(transcludeFn);\n\n      $static.on('mouseover', () => {\n        scope.showEditHint = true;\n        scope.$apply();\n      });\n\n      $static.on('mouseout', () => {\n        scope.showEditHint = false;\n        scope.$apply();\n      });\n\n      scope.$watch(() => scope.isEditing, onIsEditingChange);\n\n      function transcludeFn(clone, innerScope) {\n        let input = Array.prototype.filter.call(clone, (el) => {\n          return (el.nodeName.toLowerCase() === 'input' || el.nodeName.toLowerCase() === 'textarea');\n        });\n\n        $input = angular.element(input);\n\n        $content.append($compile($input)(innerScope));\n      }\n\n      function onIsEditingChange(value) {\n        if (value) {\n          $timeout(() => $input[0].focus());\n          $input.on('blur keypress', validate);\n        }\n        else {\n          $input.off('blur keypress', validate);\n        }\n\n        if (scope.onEditChange) {\n          scope.onEditChange({isEditing: angular.copy(value)});\n        }\n      }\n\n      function validate(evt) {\n        if (evt.type !== 'blur' && evt.keyCode !== KEYS.ENTER) {\n          return;\n        }\n\n        let isEditing      = false;\n        let isModelEmpty   = angular.isDefined(scope.model) ? (scope.model.search(/\\w+/g) < 0) : true;\n        let inputCtrl      = formCtrl[$input.attr('name')];\n\n        if (inputCtrl) {\n          isEditing = inputCtrl.$invalid;\n\n          if (inputCtrl.$invalid && scope.onInvalid) {\n            scope.onInvalid({$error: angular.copy(inputCtrl.$error)});\n          }\n        }\n\n        // if model is empty should not be allowed to exit edit mode\n        isEditing = isModelEmpty ? true : isEditing;\n\n        scope.isEditing = isEditing;\n        scope.$apply();\n      }\n    }\n  });\n\n  return m.name;\n\n}));"]}